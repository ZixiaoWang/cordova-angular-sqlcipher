'use strict';
angular.module("ngSqlcipher",[]).provider("sqlcipherConfig",function(){var b={name:"admin",password:"admin",location:"default",iosDatabaseLocation:"defalult"},c=!1;this.onConnectSuccess=new Function,this.onConnectError=new Function,this.onSuccess=new Function,this.onError=new Function,this.test=function(a,b){c=!0,a&&(this.onConnectSuccess=a),b&&(this.onConnectError=b)},this.open=function(a,c,d){null!=a.name&&void 0!=a.name?b.name=a.name:null!=a.password&&void 0!=a.password?b.password=a.password:null!=a.location&&void 0!=a.location?b.location=a.location:null!=a.iosDatabaseLocation&&void 0!=a.iosDatabaseLocation&&(b.iosDatabaseLocation=a.iosDatabaseLocation),c&&(this.onSuccess=c),d&&(this.onError=d)},this.$get=["$window",function(a){var d;return c&&a.sqlitePlugin.echoTest(this.onConnectSuccess,this.onConnectError),d=a.sqlitePlugin.openDatabase(b,this.onSuccess,this.onError),d.__proto__.addTrans=d.__proto__.addTransaction,d.__proto__.addTransaction=function(a){a.__proto__.exec=a.__proto__.executeSql,d.__proto__.addTrans.call(this,a)},d}]}).factory("$sqlcipher",["sqlcipherConfig","$window","$q",function(a,b,c){var d=function(){this.core=a,this._version=null};return d.prototype.exec=function(b,d){return c(function(c,e){a.executeSql(b,d,c,e)})},d.prototype.batch=function(b){return c(function(c,d){a.sqlBatch(b,c,d)})},d.prototype.trans=function(b){return c(function(c,d){a.transaction(b,d,c)})},d.prototype.readTrans=function(b){return c(function(c,d){a.transaction(b,d,c)})},d.prototype.close=function(){return c(function(b,c){a.close(b,c)})},d.prototype.createTable=function(b,c,d,e){var f="CREATE TABLE "+b+" ",g=[],h="";if("object"==typeof c)Object.keys(c).forEach(function(a){h="",h=a+" ",h+=c[a].type?c[a].type:"",h+=c[a].isNull?"NULL ":"NOT NULL ",h+=c[a].primary?"PRIMARY ":"",h+=c[a].autoIncrement?"AUTO INCREMENT ":"",h+=c[a].default?"DEFAULT "+c[a].defalult:"",h+=c[a].unique?"UNIQUE ":"",h+=c[a].check?c[a].check:"",g.push(h)}),f+="("+g.join(" ")+")";else if("string"==typeof c)f+="("+c+")";else if(c instanceof Array)c.forEach(function(a,b){"string"==typeof a?g.push(a):"object"==typeof a&&(h="",h+=a.name+" ",h+=a.type?a.type+" ":"",h+=a.isNull?"NULL ":"NOT NULL ",h+=a.primary?"PRIMARY ":"",h+=a.autoIncrement?"AUTO INCREMENT ":"",h+=a.default?"DEFAULT "+c[a].defalult:"",h+=a.unique?"UNIQUE ":"",h+=a.check?c[a].check:"",g.push(h))}),f+="("+g.join(" ")+")";else{if(void 0!==c)throw new Error("Options has to be String or Array");console.warn("Table columns are suggested to be configured! column ID will be created automatically."),f+="(id INTEGER )"}return a.executeSql(f,d,e),this},d.prototype.dropTable=function(b,c,d){if("string"!=typeof b)throw new Error("Table name must be in String type.");var e="DROP TABLE "+b;return a.executeSql(e,c,d),this},d.prototype.truncate=function(b){if("string"!=typeof b)throw new Error("Table name must be in String type.");return c(function(c,d){a.executeSql("DELETE FROM "+b,c,d)})},d.prototype.select=function(b,d,e){var f="",g=[],h={};if("string"!=typeof b)throw new Error("table name must be a String.");if(null==d)f="SELECT * FROM "+b;else if(d instanceof Array&&0==d.length)f="SELECT * FROM "+b;else{if(!(d instanceof Array&&d.length>0))throw new Error(d+"cannot resolve type.");g=d.join(),f="SELECT "+g+" FROM "+b+" "}return h&&(h.where&&(f=" WHERE "+h.where.replace(/&&/g," AND ").replace(/\|\|/g," OR ")),h.groupby&&(h.groupby instanceof Array?(f+=" GROUP BY ",f+=h.groupby.join()):"string"==typeof h.groupby&&(f+=" GROUP BY",f+=h.groupby)),h.having&&"string"==typeof h.having&&(f+=" HAVING ",f+=h.having),h.orderby&&h.orderby instanceof Array?f+=" ORDER BY "+h.orderby.join():h.orderby&&"string"==typeof h.orderby&&(f+=h.orderby),"string"==typeof h.sort&&"desc"===h.sort.toLowerCase&&h.orderby?f+=" DESC":h.orderby&&(f+=" ASC")),c(function(b,c){a.executeSql(f,[],b,c)})},d.prototype.selectAll=function(b){if("string"!=typeof b)throw new Error("Table name must be in String type.");var d="SELECT * FROM "+b;return c(function(b,c){a.executeSql(d,[],b,c)})},d.prototype.insert=function(b,d){function g(b,c,g){for(var h=0;h<b.rows.length;h++)e.push(b.rows.item(h).name);return d.forEach(function(a,b){0==b?(f+=" SELECT ",e.forEach(function(b,c){a[b]&&(c<e.length-1?(f+='"',f+=a[b]?a[b]:"",f+='" AS '+b+", "):(f+='"',f+=a[b]?a[b]:"",f+='" AS '+b))})):(f+=" UNION ALL SELECT ",e.forEach(function(b,c){a[b]&&(c<e.length-1?(f+='"',f+=a[b]?a[b]:"",f+='" AS '+b+", "):(f+='"',f+=a[b]?a[b]:"",f+='" AS '+b))}))}),a.executeSql(f,[],c,g)}if("string"!=typeof b)throw new Error(b+" is not a String.");if(!(d instanceof Array))throw new Error("options must be an Array");if(0==d.length)throw new Error("option length is 0");var e=[],f="INSERT INTO "+b;return c(function(c,d){a.executeSql("PRAGMA table_info("+b+")",[],function(a){return g(a,c,d)},d)})},d.prototype.renameTable=function(b,d){return c(function(c,d){a.executeSql("ALTER TABLE "+b+" RENAME TO new_name",[],c,d)})},d.prototype.addColumns=function(b,d){if("string"!=typeof b)throw new Error("table name is not a string");if("string"==typeof d)return c(function(c,e){a.executeSql("ALTER TABLE "+b+" ADD COLUMN "+d)});if(d instanceof Array){var e=[],f="ALTER TABLE "+b+" ADD COLUMN ",g="";return 0==d.length?(console.warn("No columns are added."),null):(d.forEach(function(a,b){"string"==typeof a?e.push(f+a):"object"==typeof a&&(g="",g+=a.name+" ",g+=a.type?a.type+" ":"",g+=a.isNull?"NULL ":"NOT NULL ",g+=a.primary?"PRIMARY ":"",g+=a.autoIncrement?"AUTO INCREMENT ":"",g+=a.default?"DEFAULT "+d[a].defalult:"",g+=a.unique?"UNIQUE ":"",g+=a.check?d[a].check:"",e.push(f+g))}),c(function(b,c){a.transaction(function(a){e.forEach(function(b){a.executeSql(b)})},c,b)}))}throw new Error("options must be String or Array.")},d.prototype.update=function(b,d,e){if("string"!=typeof b)throw new Error("table name must be String");if("object"!=typeof d)throw new Error("options must be an options");var f="UPDATE "+b+" SET ",g=[],h=e,i=Object.keys(d);return i.forEach(function(a,b){if("number"==typeof d[a])g.push(a+" = "+d[a]);else if("string"==typeof d[a])g.push(a+' = "'+d[a]+'"');else{if("function"!=typeof d[a])throw new Error(a+" cannot resolve type.");var c=d[a]();if("number"==typeof c)g.push(a+" = "+c);else{if("string"!=typeof c)throw new Error(a+" cannot resolve type.");g.push(a+' = "'+c+'"')}}}),f+=g.join(),h&&h.where&&(f=" WHERE "+h.where.replace(/&&/g," AND ").replace(/\|\|/g," OR ")),c(function(b,c){a.executeSql(f,[],b,c)})},new d}]);

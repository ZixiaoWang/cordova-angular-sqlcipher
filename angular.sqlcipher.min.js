"use strict";
angular.module("ngSqlcipher",[]).provider("sqlcipherConfig",function(){var t={name:"admin",password:"admin",location:"default",iosDatabaseLocation:"defalult"},e=!1;this.onConnectSuccess=new Function,this.onConnectError=new Function,this.onSuccess=new Function,this.onError=new Function,this.test=function(t,n){e=!0,t&&(this.onConnectSuccess=t),n&&(this.onConnectError=n)},this.open=function(e,n,o){null!=e.name&&void 0!=e.name?t.name=e.name:null!=e.password&&void 0!=e.password?t.password=e.password:null!=e.location&&void 0!=e.location?t.location=e.location:null!=e.iosDatabaseLocation&&void 0!=e.iosDatabaseLocation&&(t.iosDatabaseLocation=e.iosDatabaseLocation),n&&(this.onSuccess=n),o&&(this.onError=o)},this.$get=["$window",function(n){var o;return e&&n.sqlitePlugin.echoTest(this.onConnectSuccess,this.onConnectError),o=n.sqlitePlugin.openDatabase(t,this.onSuccess,this.onError),o.__proto__.addTrans=o.__proto__.addTransaction,o.__proto__.addTransaction=function(t){t.__proto__.exec=t.__proto__.executeSql,o.__proto__.addTrans.call(this,t)},o}]}).factory("$sqlcipher",["sqlcipherConfig","$window","$q",function(t,e,n){var o=function(){this.core=t,this._version=null};return o.prototype.exec=function(e,o){return n(function(n,r){t.executeSql(e,o,n,r)})},o.prototype.batch=function(e){return n(function(n,o){t.sqlBatch(e,n,o)})},o.prototype.trans=function(e){return n(function(n,o){t.transaction(e,o,n)})},o.prototype.readTrans=function(e){return n(function(n,o){t.transaction(e,o,n)})},o.prototype.close=function(){return n(function(e,n){t.close(e,n)})},o.prototype.createTable=function(e,n,o,r){var i="CREATE TABLE "+e+" ",a=[],c="";if(Array.isArray(n)||"object"!=typeof n)if("string"==typeof n)i+="("+n+")";else if(n instanceof Array)n.forEach(function(t,e){"string"==typeof t?a.push(t):"object"==typeof t&&(c="",c+=t.name+" ",c+=t.type?t.type+" ":"",c+=t.notNull?"NOT NULL ":"",c+=t.primary?"PRIMARY ":"",c+=t.autoIncrement?"AUTO INCREMENT ":"",c+=t["default"]?"DEFAULT "+n[t].defalult:"",c+=t.unique?"UNIQUE ":"",c+=t.check?n[t].check:"",a.push(c))}),i+="("+a.join(", ")+")";else{if(void 0!==n)throw new Error("Options has to be String or Array");console.warn("Table columns are suggested to be configured! column ID will be created automatically."),i+="(id INTEGER )"}else Object.keys(n).forEach(function(t){c="",c=t+" ",c+=n[t].type?n[t].type:"",c+=n[t].notNull?"NOT NULL ":"",c+=n[t].primary?"PRIMARY ":"",c+=n[t].autoIncrement?"AUTO INCREMENT ":"",c+=n[t]["default"]?"DEFAULT "+n[t].defalult:"",c+=n[t].unique?"UNIQUE ":"",c+=n[t].check?n[t].check:"",a.push(c)}),i+="("+a.join(",")+")";return t.executeSql(i,o,r),this},o.prototype.dropTable=function(e,n,o){if("string"!=typeof e)throw new Error("Table name must be in String type.");var r="DROP TABLE "+e;return t.executeSql(r,n,o),this},o.prototype.truncate=function(e){if("string"!=typeof e)throw new Error("Table name must be in String type.");return n(function(n,o){t.executeSql("DELETE FROM "+e,n,o)})},o.prototype.select=function(e,o,r){var i="",a=[],c={};if("string"!=typeof e)throw new Error("table name must be a String.");if(null==o)i="SELECT * FROM "+e;else if(o instanceof Array&&0==o.length)i="SELECT * FROM "+e;else{if(!(o instanceof Array&&o.length>0))throw new Error(o+"cannot resolve type.");a=o.join(),i="SELECT "+a+" FROM "+e+" "}return c&&(c.where&&(i=" WHERE "+c.where.replace(/&&/g," AND ").replace(/\|\|/g," OR ")),c.groupby&&(c.groupby instanceof Array?(i+=" GROUP BY ",i+=c.groupby.join()):"string"==typeof c.groupby&&(i+=" GROUP BY",i+=c.groupby)),c.having&&"string"==typeof c.having&&(i+=" HAVING ",i+=c.having),c.orderby&&c.orderby instanceof Array?i+=" ORDER BY "+c.orderby.join():c.orderby&&"string"==typeof c.orderby&&(i+=c.orderby),"string"==typeof c.sort&&"desc"===c.sort.toLowerCase&&c.orderby?i+=" DESC":c.orderby&&(i+=" ASC")),n(function(e,n){t.executeSql(i,[],e,n)})},o.prototype.selectAll=function(e){if("string"!=typeof e)throw new Error("Table name must be in String type.");var o="SELECT * FROM "+e;return n(function(e,n){t.executeSql(o,[],e,n)})},o.prototype.insert=function(e,o){function r(e,n,r){for(var c=0;c<e.rows.length;c++)i.push(e.rows.item(c).name);return o.forEach(function(t,e){0==e?(a+=" SELECT ",i.forEach(function(e,n){t[e]&&(n<i.length-1?(a+='"',a+=t[e]?t[e]:"",a+='" AS '+e+", "):(a+='"',a+=t[e]?t[e]:"",a+='" AS '+e))})):(a+=" UNION ALL SELECT ",i.forEach(function(e,n){t[e]&&(n<i.length-1?(a+='"',a+=t[e]?t[e]:"",a+='" AS '+e+", "):(a+='"',a+=t[e]?t[e]:"",a+='" AS '+e))}))}),t.executeSql(a,[],n,r)}if("string"!=typeof e)throw new Error(e+" is not a String.");if(!(o instanceof Array))throw new Error("options must be an Array");if(0==o.length)throw new Error("option length is 0");var i=[],a="INSERT INTO "+e;return n(function(n,o){t.executeSql("PRAGMA table_info("+e+")",[],function(t){return r(t,n,o)},o)})},o.prototype.renameTable=function(e,o){return n(function(n,r){t.executeSql("ALTER TABLE "+e+" RENAME TO "+o,[],n,r)})},o.prototype.addColumns=function(e,o){if("string"!=typeof e)throw new Error("table name is not a string");if("string"==typeof o)return n(function(n,r){t.executeSql("ALTER TABLE "+e+" ADD COLUMN "+o)});if(o instanceof Array){var r=[],i="ALTER TABLE "+e+" ADD COLUMN ",a="";return 0==o.length?(console.warn("No columns are added."),null):(o.forEach(function(t,e){"string"==typeof t?r.push(i+t):"object"==typeof t&&(a="",a+=t.name+" ",a+=t.type?t.type+" ":"",a+=t.notNull?"NOT NULL ":"",a+=t.primary?"PRIMARY ":"",a+=t.autoIncrement?"AUTO INCREMENT ":"",a+=t["default"]?"DEFAULT "+o[t].defalult:"",a+=t.unique?"UNIQUE ":"",a+=t.check?o[t].check:"",r.push(i+a))}),n(function(e,n){t.transaction(function(t){r.forEach(function(e){t.executeSql(e)})},n,e)}))}throw new Error("options must be String or Array.")},o.prototype.update=function(e,o,r){if("string"!=typeof e)throw new Error("table name must be String");if("object"!=typeof o)throw new Error("options must be an options");var i="UPDATE "+e+" SET ",a=[],c=r,s=Object.keys(o);return s.forEach(function(t,e){if("number"==typeof o[t])a.push(t+" = "+o[t]);else if("string"==typeof o[t])a.push(t+' = "'+o[t]+'"');else{if("function"!=typeof o[t])throw new Error(t+" cannot resolve type.");var n=o[t]();if("number"==typeof n)a.push(t+" = "+n);else{if("string"!=typeof n)throw new Error(t+" cannot resolve type.");a.push(t+' = "'+n+'"')}}}),i+=a.join(),c&&c.where&&(i+=" WHERE "+c.where.replace(/&&/g," AND ").replace(/\|\|/g," OR ")),n(function(e,n){t.executeSql(i,[],e,n)})},new o}]);

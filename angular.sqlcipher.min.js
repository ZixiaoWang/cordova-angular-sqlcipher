"use strict";
angular.module("ngSqlcipher",[]).provider("sqlcipherConfig",function(){var t={name:"admin",password:"admin",location:"default",iosDatabaseLocation:"default"},n=!1;this.onConnectSuccess=new Function,this.onConnectError=new Function,this.onSuccess=new Function,this.onError=new Function,this.test=function(t,e){n=!0,t&&(this.onConnectSuccess=t),e&&(this.onConnectError=e)},this.open=function(n,e,o){null!=n.name&&void 0!=n.name?t.name=n.name:null!=n.password&&void 0!=n.password?t.password=n.password:null!=n.location&&void 0!=n.location?t.location=n.location:null!=n.iosDatabaseLocation&&void 0!=n.iosDatabaseLocation&&(t.iosDatabaseLocation=n.iosDatabaseLocation),e&&(this.onSuccess=e),o&&(this.onError=o)},this.$get=["$window",function(e){var o;return n&&e.sqlitePlugin.echoTest(this.onConnectSuccess,this.onConnectError),o=e.sqlitePlugin.openDatabase(t,this.onSuccess,this.onError),o.__proto__.addTrans=o.__proto__.addTransaction,o.__proto__.addTransaction=function(t){t.__proto__.exec=t.__proto__.executeSql,o.__proto__.addTrans.call(this,t)},o}]}).factory("$sqlcipher",["sqlcipherConfig","$window","$q",function(t,n,e){var o=function(){this.core=t,this._version=null};return o.prototype.exec=function(n,o){return e(function(e,r){t.executeSql(n,o,e,r)})},o.prototype.batch=function(n){return e(function(e,o){t.sqlBatch(n,e,o)})},o.prototype.trans=function(n){return e(function(e,o){t.transaction(n,o,e)})},o.prototype.readTrans=function(n){return e(function(e,o){t.transaction(n,o,e)})},o.prototype.close=function(){return e(function(n,e){t.close(n,e)})},o.prototype.createTable=function(n,o,r,i){var a="CREATE TABLE "+n+" ",c=[],u="";if(Array.isArray(o)||"object"!=typeof o)if("string"==typeof o)a+="("+o+")";else if(o instanceof Array)o.forEach(function(t,n){"string"==typeof t?c.push(t):"object"==typeof t&&(u="",u+=t.name+" ",u+=t.type?t.type+" ":"",u+=t.notNull?"NOT NULL ":"",u+=t.primary?"PRIMARY ":"",u+=t.autoIncrement?"AUTOINCREMENT ":"",u+=t["default"]?"DEFAULT "+o[t]["default"]:"",u+=t.unique?"UNIQUE ":"",u+=t.check?o[t].check:"",c.push(u))}),a+="("+c.join(", ")+")";else{if(void 0!==o)throw new Error("Options has to be String or Array");console.warn("Table columns are suggested to be configured! column ID will be created automatically."),a+="(id INTEGER )"}else Object.keys(o).forEach(function(t){u="",u=t+" ",u+=o[t].type?o[t].type:"",u+=o[t].notNull?"NOT NULL ":"",u+=o[t].primary?"PRIMARY ":"",u+=o[t].autoIncrement?"AUTOINCREMENT ":"",u+=o[t]["default"]?"DEFAULT "+o[t]["default"]:"",u+=o[t].unique?"UNIQUE ":"",u+=o[t].check?o[t].check:"",c.push(u)}),a+="("+c.join(",")+")";return e(function(n,e){t.executeSql(a,[],n,e)})},o.prototype.dropTable=function(n,o,r){if("string"!=typeof n)throw new Error("Table name must be in String type.");var i="DROP TABLE "+n;return e(function(n,e){t.executeSql(i,[],n,e)})},o.prototype.truncate=function(n){if("string"!=typeof n)throw new Error("Table name must be in String type.");return e(function(e,o){t.executeSql("DELETE FROM "+n,e,o)})},o.prototype.select=function(n,o,r){var i="",a=[],c={};if("string"!=typeof n)throw new Error("table name must be a String.");if(null==o)i="SELECT * FROM "+n;else if(o instanceof Array&&0==o.length)i="SELECT * FROM "+n;else{if(!(o instanceof Array&&o.length>0))throw new Error(o+"cannot resolve type.");a=o.join(),i="SELECT "+a+" FROM "+n+" "}return c&&(c.where&&(i=" WHERE "+c.where.replace(/&&/g," AND ").replace(/\|\|/g," OR ")),c.groupby&&(c.groupby instanceof Array?(i+=" GROUP BY ",i+=c.groupby.join()):"string"==typeof c.groupby&&(i+=" GROUP BY",i+=c.groupby)),c.having&&"string"==typeof c.having&&(i+=" HAVING ",i+=c.having),c.orderby&&c.orderby instanceof Array?i+=" ORDER BY "+c.orderby.join():c.orderby&&"string"==typeof c.orderby&&(i+=c.orderby),"string"==typeof c.sort&&"desc"===c.sort.toLowerCase&&c.orderby?i+=" DESC":c.orderby&&(i+=" ASC")),e(function(n,e){t.executeSql(i,[],n,e)})},o.prototype.selectAll=function(n){if("string"!=typeof n)throw new Error("Table name must be in String type.");var o="SELECT * FROM "+n;return e(function(n,e){t.executeSql(o,[],n,e)})},o.prototype.insert=function(n,o){function r(n,e,r){for(var c=0;c<n.rows.length;c++)i.push(n.rows.item(c).name);return o.forEach(function(t,n){0==n?(a+=" SELECT ",i.forEach(function(n,e){t[n]&&(e<i.length-1?(a+='"',a+=t[n]?t[n]:"",a+='" AS '+n+", "):(a+='"',a+=t[n]?t[n]:"",a+='" AS '+n))})):(a+=" UNION ALL SELECT ",i.forEach(function(n,e){t[n]&&(e<i.length-1?(a+='"',a+=t[n]?t[n]:"",a+='" AS '+n+", "):(a+='"',a+=t[n]?t[n]:"",a+='" AS '+n))}))}),t.executeSql(a,[],e,r)}if("string"!=typeof n)throw new Error(n+" is not a String.");if(!(o instanceof Array))throw new Error("options must be an Array");if(0==o.length)throw new Error("option length is 0");var i=[],a="INSERT INTO "+n;return e(function(e,o){t.executeSql("PRAGMA table_info("+n+")",[],function(t){return r(t,e,o)},o)})},o.prototype.renameTable=function(n,o){return e(function(e,r){t.executeSql("ALTER TABLE "+n+" RENAME TO "+o,[],e,r)})},o.prototype.addColumns=function(n,o){if("string"!=typeof n)throw new Error("table name is not a string");if("string"==typeof o)return e(function(e,r){t.executeSql("ALTER TABLE "+n+" ADD COLUMN "+o)});if(o instanceof Array){var r=[],i="ALTER TABLE "+n+" ADD COLUMN ",a="";return 0==o.length?(console.warn("No columns are added."),null):(o.forEach(function(t,n){"string"==typeof t?r.push(i+t):"object"==typeof t&&(a="",a+=t.name+" ",a+=t.type?t.type+" ":"",a+=t.notNull?"NOT NULL ":"",a+=t.primary?"PRIMARY ":"",a+=t.autoIncrement?"AUTOINCREMENT ":"",a+=t["default"]?"DEFAULT "+t["default"]:"",a+=t.unique?"UNIQUE ":"",a+=t.check?t.check:"",r.push(i+a))}),e(function(n,e){t.transaction(function(t){r.forEach(function(n){t.executeSql(n)})},e,n)}))}throw new Error("options must be String or Array.")},o.prototype.update=function(n,o,r){if("string"!=typeof n)throw new Error("table name must be String");if("object"!=typeof o)throw new Error("options must be an options");var i="UPDATE "+n+" SET ",a=[],c=r,u=Object.keys(o);return u.forEach(function(t,n){if("number"==typeof o[t])a.push(t+" = "+o[t]);else if("string"==typeof o[t])a.push(t+' = "'+o[t]+'"');else{if("function"!=typeof o[t])throw new Error(t+" cannot resolve type.");var e=o[t]();if("number"==typeof e)a.push(t+" = "+e);else{if("string"!=typeof e)throw new Error(t+" cannot resolve type.");a.push(t+' = "'+e+'"')}}}),i+=a.join(),c&&c.where&&(i+=" WHERE "+c.where.replace(/&&/g," AND ").replace(/\|\|/g," OR ")),e(function(n,e){t.executeSql(i,[],n,e)})},new o}]);
